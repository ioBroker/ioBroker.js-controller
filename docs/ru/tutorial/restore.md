---
title: Запустите ioBroker Restore
lastChanged: 03.12.2019
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/tutorial/restore.md
hash: 9SyQw5gWCDpvFS0ksEa7NULgmuancyWYV7tkASkVhpg=
---
# Основы
Как правильно восстановить установку ioBroker в системе Linux?

### Предисловие:
Поскольку некоторым пользователям очень сложно восстановить, пошаговые инструкции по восстановлению после сбоя или после смены оборудования, системы или чего-то еще должны помочь.

В принципе, можно заранее сказать одно: восстановление может быть выполнено за несколько минут, если оно выполнено правильно, и никому не нужно этого бояться.

В конце концов, все данные снова стали доступны, и была создана новая система.

### Подготовка:
Для подготовки необходима установка исполняемого ioBroker.

Это можно сделать двумя способами.
Либо возьмите готовый образ из [Область загрузки](https://www.iobroker.net/#de/download), настройте свою собственную ОС Linux и установите ioBroker в соответствии с этим [руководство по эксплуатации](https://www.iobroker.net/#de/documentation/install/linux.md).

### Следующий шаг
Если старая система сохраняла состояния и / или объекты в Redis, новая система сначала должна быть оснащена сервером Redis.

Если вы не уверены, использовался ли Redis, и все еще есть доступ к старой системе, используйте команду `iobroker status`, чтобы получить необходимую информацию. «При использовании Redis вывод выглядит следующим образом:

```
iobroker is running on this host.

At least one iobroker host is running.

Objects type: redis
States  type: redis
```

Если «redis» записан в типе объектов и / или типе состояний, вам необходимо установить сервер Redis в новой системе.
Если оба типа говорят «файл», сервер Redis не требуется.

Если у вас больше нет доступа к старой системе и вы не знаете, что именно было настроено ранее, вам обязательно нужно заранее установить сервер Redis.

#### Redis установлен:
Для этого заходим в терминал по шпатлевке и выполняем следующие команды:

```
sudo apt-get update
sudo apt-get install redis-server
sudo usermod -a -G redis iobroker
sudo reboot now
```

Следующее, что нужно сделать, - запустить исправление установщика, если у вас нет всех прав в системе.
Этот шаг носит рекомендательный характер и не является абсолютно необходимым.

```
curl -sL https://iobroker.net/fix.sh | bash –
```

С помощью небольшого инструмента «htop» вы можете очень хорошо видеть все запущенные процессы, что не только интересно для восстановления, но и очень полезно в целом.
это устанавливается следующим образом:

Выполните в консоли следующую команду:

```
sudo apt-get install htop
```

После того, как это будет сделано, можно приступить к фактическому восстановлению.

### Восстановить:
Также есть 2 варианта:

#### **1. Автоматическое восстановление с резервной копией**
Поскольку здесь не требуется никаких знаний о Linux, а все это делается через веб-интерфейс Iobroker, сначала имеет место вариант автоматического восстановления с использованием [Резервное копирование](https://github.com/simatec/ioBroker.backitup/blob/master/README.md).

Для этого должен быть установлен адаптер Backitup.
Это делается через вкладку «Адаптер». Найдите там Backitup и установите экземпляр, используя (+).

После завершения установки вы сохраняете «резервную копию ioBroker», созданную ранее старой системой, в новой системе с помощью программы sftp, такой как FileZilla или WinSCP, в пути / opt / iobroker / backups.

Резервное копирование также может выполнять восстановление с NAS, Dropbox или Google Drive, но локальный вариант имеет меньше всего проблем.

Если у вас уже есть опыт монтажа NAS, это также можно использовать, тем более что после этого вы можете получить прямой доступ к существующему каталогу старой установки.
Однако это руководство относится к локально хранимой резервной копии.

Если резервная копия ioBroker была успешно сохранена, откроется резервная копия и откроется вкладка «Восстановление».
Там установите «Источник резервной копии» на «Локальный», а затем сохраните его.

![Вкладка "Восстановить"](../../de/tutorial/media/restore/1575301096581-restoretab.jpg)

Если ВСЕ экземпляры должны запускаться автоматически после восстановления, необходимо активировать опцию «Запустить все адаптеры после восстановления» и затем сохранить.
Если резервная копия должна быть восстановлена на другом хосте, этот параметр не следует использовать, так как IP-адреса, возможно, придется изменить перед запуском отдельных экземпляров.

После сохранения существующие резервные копии можно вызвать по локальному пути с помощью кнопки «Получить резервные копии».

Резервная копия, только что скопированная через FTP, должна появиться в списке под «iobroker».
Выберите это сейчас.

![Подбор резервных копий](../../de/tutorial/media/restore/1575301146928-restoreliste.jpg)

После выбора появится сообщение о том, что iobroker будет остановлен для восстановления, а затем перезапущен.

![Начать восстановление](../../de/tutorial/media/restore/1575301175231-restorestart.jpg)

Здесь вы начали собственно процесс восстановления.

![Восстановление в процессе](../../de/tutorial/media/restore/1575301208033-restore.jpg)

В вашем браузере откроется еще одна вкладка, в которой вы можете следить за процессом восстановления в Backitup WebUI, как и на консоли.

![восстановитьWebUI.JPG](../../de/tutorial/media/restore/restoreWebUI.JPG)

После успешного завершения восстановления вы также получите сообщение в WebUi восстановления.

![restoreWebUI_finish.JPG](../../de/tutorial/media/restore/restoreWebUI_finish.JPG)

Восстановление может занять некоторое время в зависимости от производительности системы и размера старой установки ioBroker.
Обычно восстановление выполняется примерно через 10-15 минут, и ioBroker должен запускаться снова автоматически.

![Восстановление выполнено](../../de/tutorial/media/restore/1575301228008-restorefinish.jpg)

В очень редких случаях ioBroker не запускается автоматически после восстановления.
В этом случае вы можете запустить iobroker вручную с помощью следующей команды через консоль.

```
iobroker start
```

Теперь ioBroker должен запуститься снова, а вкладка «Журнал» показывает, что все адаптеры, которые были установлены в старой системе, в настоящее время переустанавливаются с помощью npm.

Здесь нужно набраться терпения и позволить iobroker сделать это.
В экземплярах вы можете увидеть, какие адаптеры устанавливаются постепенно.
Все адаптеры, которые все еще устанавливаются или находятся в режиме ожидания, еще не имеют значка в экземплярах.
Пожалуйста, не перезапускайте ioBroker, самое большее время от времени обновляйте представление с помощью F5, пока все экземпляры не будут отмечены значком.

В зависимости от размера установки, скорости вашего компьютера и подключения к Интернету это может занять 2-3 часа.

Поздравляем, недавно установленная система теперь укомплектована всеми настройками, скриптами, визуализациями и т. Д.

С помощью Backitup теперь есть возможность восстановить дополнительные данные, если они были заранее зарезервированы в старой системе.
Вы можете восстановить базу данных Redis, базу данных Zigbee, базу данных mySql и данные своей истории с помощью тех же шагов, которые описаны выше.

В этом случае список извлеченных резервных копий будет выглядеть следующим образом.

![полный список](../../de/tutorial/media/restore/1575362131512-fullliste.jpg)

*****************************************************************************************************************************************

#### **2. ручное восстановление с помощью команд терминала**
Прежде всего, нужно отправить несколько команд через Putty или что-то подобное.

Сначала необходимо создать резервную папку:

```
sudo mkdir /opt/iobroker/backups
```

Здесь тоже есть программа sftp, такая как FileZilla или WinSCP - резервная копия, созданная в старой системе, а также, возможно, резервная копия Redis, резервная копия zigbee и т. Д.
в папке / opt / iobroker / backups.

Если состояния и объекты были сохранены в базе данных Redis, сохраненная база данных Redis должна быть сначала восстановлена здесь.
Если бы только состояния работали под Redis, это не обязательно должно быть заранее.

Как только это будет сделано, вы остановите свой ioBroker следующим образом:

```
iobroker stop
```

Затем проверьте, все ли остановлено, с помощью следующих команд:

```
iobroker status
```

Если все выходы верны и iobroker был остановлен, восстановление теперь можно выполнить через консоль с помощью следующих команд:

```
cd /opt/iobroker
iobroker restore <Dateiname eures Backups>
```

!> **Очень важно, чтобы этим методом можно было восстановить только одну резервную копию ioBroker.
С помощью этой команды невозможно создать резервную копию Redis, резервную копию Zigbee, резервную копию mySql или данные истории**

Для этого требуется резервное копирование, так как оно было специально создано с помощью резервного копирования.

В зависимости от вашей системы это может занять несколько минут. Прогресс отображается в терминале.
Когда восстановление будет завершено, перезапустите ioBroker с помощью следующей команды:

```
iobroker start
```

И здесь все адаптеры теперь переустанавливаются индивидуально с помощью ioBroker через npm.
Это может занять некоторое время в зависимости от размера вашей установки, скорости интернета и производительности системы.
Текущее состояние можно отслеживать во вкладке «Журнал».

Теперь это сделано, система переустановлена, а все настройки, сценарии, визуализации и т. Д. Восстановлены.

### Вывод:
По сути, оба варианта приводят к одному и тому же результату.
Если у вас мало опыта работы с командами терминала и вы чувствуете себя небезопасно, вы в безопасности с помощью Backitup.

Однако, если вы хотите точно видеть, что происходит в вашей системе, вам следует выбрать ручной вариант через консоль. Здесь вы можете подробно увидеть каждый процесс в терминале.