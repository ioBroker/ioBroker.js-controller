---
title: Мультихост
lastChanged: 13.09.2018
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/config/multihost.md
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
hash: ZK6+69/2TfNCap3aqV0VaFy58lXm/Z6Q2ksbjmj30h8=
---
# Работа с несколькими хостами
ioBroker может выполнять задачи на нескольких серверах. Это позволяет распределять нагрузку обработки между несколькими хостами.
Однако вы также можете использовать системные расширения одноплатного компьютера (GPIO от RaspberryPi, хотя «главный компьютер» - это более мощный Intel NUC).

После создания многоузловой системы все настройки выполняются централизованно через главного администратора. Администратор подчиненных устройств больше не доступен через их веб-интерфейсы.

Поэтому имеет смысл использовать хост с минимальной установкой для ведомого устройства, т.е. только js-контроллер и админку.

## Установка
### Основная конфигурация
Выполните на мастере следующую команду:

** Этот шаг абсолютно необходим, если используется Redis DB. ** В других случаях его можно использовать, если автоматический метод (см. Ниже) не работает. Тогда выберите f (ile) вместо r (edis)!

звоните через консоль:

1. `iobroker setup custom`

Заполните появившееся меню следующим образом

```
Type of objects DB [(f)ile, (c)ouch, (r)edis], default [file]: f
Host / Unix Socket of objects DB(file), default[0.0.0.0]:
Port of objects DB(file), default[9001]:
Type of states DB [(f)file, (r)edis], default [file]: r
Host / Unix Socket of states DB (redis), default[127.0.0.1]: 0.0.0.0
Port of states DB (redis), default[6379]:
Data directory (file), default[../../../iobroker-data/]: /opt/iobroker/iobroker-data/
Host name of this machine [ioBroker-RasPi]:
```

2. `iobroker multihost enable`

``` enter pass phrase```

3. `sudo service iobroker restart`

### Конфигурация ведомого
** Этот шаг абсолютно необходим, если используется Redis DB. **

Пожалуйста, войдите через консоль на ведомом устройстве

1. `iobroker setup custom`

Заполните появившееся меню следующим образом

```
Type of objects DB [(f)ile, (c)ouch, (r)edis], default [file]: f
Host / Unix Socket of objects DB(file), default[127.0.0.1]: <MASTER-IP>
Port of objects DB(file), default[9001]:
Type of states DB [(f)file, (r)edis], default [file]: r
Host / Unix Socket of states DB (redis), default[<MASTER-IP>]:
Port of states DB (redis), default[6379]:
Host name of this machine [raspi-sub-1]:
```

в конце появляется информация:

```
creating conf/iobroker.json
```

2. `iobroker multihost connect`

и соответственно заполните следующие диалоговые окна:

```
1 |       <MASTER-IP> |  host |       192.168.86.42 | "authentication required"
Please select host [1]: 1
Enter secret phrase for connection: *****

Config ok. Please restart ioBroker: "iobroker restart"
```

2. `sudo service iobroker restart`

После этого вновь созданный хост появится в основной системе в разделе «Хосты».

Если этого не произошло, перезагрузите оба хоста. сначала мастер, затем раб.

## Мультихост с разными подсетями
** Если оба хоста ioBroker находятся в разных подсетях, ...

Пример:**

* Обычная LAN (для ПК, планшета используйте.) = 192.168.178.0/24
* IoT LAN (для Shelly, камеры и т. Д.) = 10.20.30.0/24

... автоматическая работа с несколькими хостами («sudo iobroker multihost enable» и «sudo iobroker multihost browse») не работает, а работает только старым способом (`iobroker setup custom`), см. выше

## Мультихост с Redis
Если должна быть установлена многоузловая среда, в которой состояния сохраняются в Redis, есть еще несколько вещей, которые следует учитывать.

Файл redis.conf на хосте, на котором сохраняются состояния, необходимо изменить следующим образом.

```
nano /etc/redis/redis.conf
```

Строка `bind 127.0.0.1`, содержащаяся в ней, должна быть дополнена IP-адресом сетевого адаптера, чтобы сервер Redis разрешал подключение извне.

Так например

```
bind 127.0.0.1 192.168.1.10
```

предполагая, что 192.168.1.10 - это локальный IP-адрес мастера ioBroker.

Эта регулировка необходима только на мастере.

В качестве альтернативы также работает

```
bind 0.0.0.0
```

Наконец, перезапустите сервер или компьютер Redis. например:

```
sudo service redis-server restart
```

## Распределить задачи
Распределить задачи между хостами можно двумя способами.

* Если это новая установка, выберите хост, на котором должен быть установлен экземпляр адаптера, на вкладке «Адаптер» в раскрывающемся меню над списком адаптеров.

Затем добавьте туда экземпляр, щелкнув (+) в правом столбце.

* Если вы уже установили много адаптеров на хосте, вы можете изменить назначение установленных экземпляров на вкладке «Экземпляры».

## Удалить хост
Чтобы удалить хост, активируйте экспертный режим на вкладке администрирования объектов мастера и активируйте выбор хоста в столбце Тип. Затем удалите желаемый хост.

## Возможные проблемы
иногда сообщение, подобное:

```> ... bytes ... in strict mode```

Затем отредактируйте файл, в котором это происходит, с помощью редактора nano. В самом начале - `'use strict';`. Прокомментируйте эту строку с помощью // и сохраните.

```> IP Address of the host is 127.0.0.1. It accepts no connections. Please change.```

если вы не выполнили ``` setup custom ``` в основной системе